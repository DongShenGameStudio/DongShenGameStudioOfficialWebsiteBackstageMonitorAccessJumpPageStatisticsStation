<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>东神游戏工作室官网监控后台访问跳转页站点</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            text-align: center;
            padding: 20px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 20px 0;
        }
        
        .header {
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .btn {
            padding: 18px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(to right, #4776E6, #8E54E9);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(to right, #FF512F, #DD2476);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .info-section {
            margin-top: auto;
            padding: 20px 0;
        }
        
        .info-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .info-panel h2 {
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .access-list {
            width: 100%;
            border-collapse: collapse;
        }
        
        .access-list th, .access-list td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .access-list th {
            background-color: rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 0;
        }
        
        .access-list tr:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .swipe-indicator {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0.7;
        }
        
        .swipe-indicator i {
            font-size: 2rem;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-20px);}
            60% {transform: translateY(-10px);}
        }
        
        .footer {
            margin-top: 30px;
            opacity: 0.7;
            font-size: 0.9rem;
            padding: 20px 0;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .btn {
                padding: 15px 25px;
                font-size: 1.1rem;
            }
            
            .access-list {
                font-size: 0.9rem;
            }
            
            .stats-bar {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        @media (max-width: 600px) {
            .access-list {
                display: block;
                overflow-x: auto;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 1rem;
            }
            
            .info-panel {
                padding: 15px;
            }
            
            .info-panel h2 {
                font-size: 1.5rem;
            }
        }
        
        /* 禁止选择文本 */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* 开发者工具检测警告 */
        #devtools-warning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: #b21f1f;
            color: white;
            padding: 15px;
            text-align: center;
            z-index: 10000;
            display: none;
            font-weight: bold;
            z-index: 10001;
        }
        
        /* 清除记录按钮 */
        .clear-btn {
            margin-top: 15px;
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .clear-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .pc-redirect-notice {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            display: none;
        }
        
        .pc-redirect-notice p {
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
            padding: 0 20px;
        }
        
        .ip-type-badge {
            font-size: 0.7em;
            padding: 2px 6px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.2);
            margin-left: 5px;
        }
        
        .ip-toggle-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
            gap: 10px;
        }
        
        .ip-toggle-btn {
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .ip-toggle-btn.active {
            background: rgba(255, 255, 255, 0.4);
        }
        
        .network-type-badge {
            font-size: 0.7em;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 5px;
        }
        
        .network-wifi {
            background: rgba(0, 255, 0, 0.2);
        }
        
        .network-mobile {
            background: rgba(255, 165, 0, 0.2);
        }
        
        .network-mixed {
            background: rgba(0, 191, 255, 0.2);
        }
        
        .device-id-badge {
            font-size: 0.7em;
            padding: 2px 6px;
            border-radius: 4px;
            background: rgba(255, 165, 0, 0.2);
            margin-left: 5px;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .api-status {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 10px;
            display: none;
        }
        
        .location-precision-badge {
            font-size: 0.7em;
            padding: 2px 6px;
            border-radius: 4px;
            background: linear-gradient(to right, #4776E6, #8E54E9);
            margin-left: 5px;
        }
        
        .countdown-timer {
            margin-top: 15px;
            font-size: 1rem;
            color: #fdbb2d;
        }
        
        .ip-column {
            min-width: 150px;
        }
        
        .location-column {
            min-width: 200px;
        }
        
        .device-model-badge {
            font-size: 0.7em;
            padding: 2px 6px;
            border-radius: 4px;
            background: rgba(128, 0, 128, 0.2);
            margin-left: 5px;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            line-height: 1.4;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="no-select">
    <div id="devtools-warning">
        <i class="fas fa-exclamation-triangle"></i> 检测到开发者工具已打开，请关闭以继续使用
    </div>
    
    <div class="pc-redirect-notice" id="pc-redirect-notice">
        <p>检测到桌面设备访问，正在跳转到错误页面...</p>
        <div class="btn btn-primary">
            <i class="fas fa-sync-alt fa-spin"></i> 跳转中
        </div>
    </div>
    
    <div class="container">
        <div class="main-content">
            <div class="header">
                <h1><i class="fas fa-shield-alt"></i> 东神游戏工作室官网监控后台...</h1>
                <p>安全访问控制系统 - 多设备访问记录</p>
            </div>
            
            <div class="buttons">
                <button class="btn btn-primary" id="main-btn">
                    <i class="fas fa-sign-in-alt"></i> 确定进入网站监控后台
                </button>
                <button class="btn btn-secondary" id="power-btn">
                    <i class="fas fa-power-off"></i> Power-0
                </button>
            </div>
            
            <div class="swipe-indicator">
                <p>向上滑动查看所有访问记录</p>
                <i class="fas fa-chevron-up"></i>
            </div>
        </div>
        
        <div class="info-section">
            <div class="info-panel">
                <div class="stats-bar">
                    <div class="stat-item">
                        <span class="stat-value" id="total-visits">0</span>
                        <span class="stat-label">总访问次数</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="unique-devices">0</span>
                        <span class="stat-label">唯一设备</span>
                    </div>
                </div>
                
                <div class="ip-toggle-container">
                    <button class="ip-toggle-btn active" id="ipv4-toggle">IPv4</button>
                    <button class="ip-toggle-btn" id="ipv6-toggle">IPv6</button>
                </div>
                
                <h2><i class="fas fa-history"></i> 访问记录</h2>
                <table class="access-list">
                    <thead>
                        <tr>
                            <th>时间</th>
                            <th>设备类型</th>
                            <th>浏览器</th>
                            <th>操作系统</th>
                            <th class="ip-column">IP 地址</th>
                            <th class="location-column">地理位置</th>
                        </tr>
                    </thead>
                    <tbody id="access-records">
                        <!-- 记录将通过JavaScript动态生成 -->
                    </tbody>
                </table>
                <button class="clear-btn" id="clear-records">清除记录</button>
            </div>
            
            <div class="footer">
                <p>© 2023 网站监控系统 | 安全访问 | 多设备记录</p>
            </div>
        </div>
    </div>

    <script>
        // 按钮功能
        document.getElementById('main-btn').addEventListener('click', function() {
            window.location.href = 'https://us.umami.is/websites/fd54c165-2845-4dcb-81a2-96bf7a7b0387';
        });
        
        document.getElementById('power-btn').addEventListener('click', function() {
            window.location.href = 'https://dongshengamestudio.github.io/DongShenGameStudioOfficialWebsiteBackstageMonitorAccessJumpPageStatisticsStation/';
        });
        
        // 获取浏览器信息
        function getBrowserInfo() {
            const userAgent = navigator.userAgent;
            let browserName = "未知浏览器";
            
            if (userAgent.includes("Chrome") && !userAgent.includes("Edg")) {
                browserName = "Chrome";
            } else if (userAgent.includes("Firefox")) {
                browserName = "Firefox";
            } else if (userAgent.includes("Safari") && !userAgent.includes("Chrome")) {
                browserName = "Safari";
            } else if (userAgent.includes("Edg")) {
                browserName = "Edge";
            } else if (userAgent.includes("MSIE") || userAgent.includes("Trident")) {
                browserName = "IE";
            } else if (userAgent.includes("Opera") || userAgent.includes("OPR")) {
                browserName = "Opera";
            }
            
            return browserName;
        }
        
        // 修复操作系统检测
        function getOSInfo() {
            const userAgent = navigator.userAgent;
            let osName = "未知操作系统";
            
            // 优先检测移动操作系统
            if (userAgent.includes("Android")) {
                osName = "Android";
            } else if (userAgent.includes("like Mac") || userAgent.includes("iPhone") || userAgent.includes("iPad")) {
                osName = "iOS";
            } else if (userAgent.includes("Win")) {
                osName = "Windows";
            } else if (userAgent.includes("Mac")) {
                osName = "MacOS";
            } else if (userAgent.includes("Linux")) {
                osName = "Linux";
            } else if (userAgent.includes("X11")) {
                osName = "UNIX";
            }
            
            return osName;
        }
        
        // 获取设备类型
        function getDeviceType() {
            const userAgent = navigator.userAgent;
            if (/Mobi|Android/i.test(userAgent)) {
                return "移动设备";
            } else if (/Tablet|iPad/i.test(userAgent)) {
                return "平板设备";
            } else {
                return "桌面设备";
            }
        }
        
        // 检测网络类型并返回标签
        function getNetworkType() {
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            let type = '未知';
            let label = '未知';
            let badgeClass = '';
            
            if (connection) {
                type = connection.type || connection.effectiveType || '未知';
                
                // 根据网络类型设置标签
                if (type.includes('wifi')) {
                    label = 'WiFi';
                    badgeClass = 'network-wifi';
                } else if (type.includes('cellular') || type.includes('3g') || type.includes('4g') || type.includes('5g')) {
                    label = '移动网';
                    badgeClass = 'network-mobile';
                } else if (navigator.onLine && type !== 'unknown') {
                    // 尝试检测混合网络情况
                    const hasWiFi = /wifi|ethernet/i.test(type);
                    const hasCellular = /cellular|3g|4g|5g/i.test(type);
                    
                    if (hasWiFi && hasCellular) {
                        label = 'WiFi+移动网';
                        badgeClass = 'network-mixed';
                    } else if (hasWiFi) {
                        label = 'WiFi';
                        badgeClass = 'network-wifi';
                    } else if (hasCellular) {
                        label = '移动网';
                        badgeClass = 'network-mobile';
                    } else {
                        label = type;
                    }
                } else {
                    label = type;
                }
            }
            
            return {
                type: type,
                label: label,
                badgeClass: badgeClass
            };
        }
        
        // 获取设备机型信息
        function getDeviceModel() {
            const userAgent = navigator.userAgent;
            let model = "未知设备";
            
            // 尝试从User-Agent中提取设备型号
            if (/Android/i.test(userAgent)) {
                // Android设备
                const match = userAgent.match(/\(.*?;\s*([^;]*?)\s*(?:Build|\))/i);
                if (match && match[1]) {
                    model = match[1].trim();
                } else {
                    model = "Android设备";
                }
            } else if (/iPhone|iPad|iPod/i.test(userAgent)) {
                // iOS设备
                if (/iPhone/i.test(userAgent)) {
                    model = "iPhone";
                    if (/iPhone\s*([0-9]+)/i.test(userAgent)) {
                        const match = userAgent.match(/iPhone\s*([0-9]+)/i);
                        model += " " + match[1];
                    }
                } else if (/iPad/i.test(userAgent)) {
                    model = "iPad";
                    if (/iPad\s*([0-9]+)/i.test(userAgent)) {
                        const match = userAgent.match(/iPad\s*([0-9]+)/i);
                        model += " " + match[1];
                    }
                }
            } else if (/Windows\s*NT/i.test(userAgent)) {
                // Windows设备
                model = "Windows PC";
                if (/Windows\s*NT\s*([0-9.]+)/i.test(userAgent)) {
                    const match = userAgent.match(/Windows\s*NT\s*([0-9.]+)/i);
                    model += " (NT " + match[1] + ")";
                }
            } else if (/Macintosh/i.test(userAgent)) {
                // Mac设备
                model = "Mac";
            }
            
            return model;
        }
        
        // 获取IP地址 - 使用指定的API
        async function getIPAddress() {
            let ipv4 = "未获取到";
            let ipv6 = "未获取到";
            let org = "未知运营商";
            let city = "未知城市";
            let region = "未知地区";
            let country = "未知国家";
            let loc = "0,0"; // 默认经纬度
            
            try {
                // 获取IPv4信息
                const ipv4Response = await fetch('https://ipinfo.io/json');
                if (ipv4Response.ok) {
                    const ipv4Data = await ipv4Response.json();
                    ipv4 = ipv4Data.ip || "未获取到";
                    org = ipv4Data.org || "未知运营商";
                    city = ipv4Data.city || "未知城市";
                    region = ipv4Data.region || "未知地区";
                    country = ipv4Data.country || "未知国家";
                    loc = ipv4Data.loc || "0,0";
                }
                
                // 获取IPv6信息
                const ipv6Response = await fetch('https://ipapi.co/json/');
                if (ipv6Response.ok) {
                    const ipv6Data = await ipv6Response.json();
                    ipv6 = ipv6Data.ip || "未获取到";
                    // 如果IPv4信息获取失败，使用IPv6的信息
                    if (ipv4 === "未获取到") {
                        org = ipv6Data.org || "未知运营商";
                        city = ipv6Data.city || "未知城市";
                        region = ipv6Data.region || "未知地区";
                        country = ipv6Data.country || "未知国家";
                    }
                }
            } catch (error) {
                console.log("获取IP信息失败:", error);
            }
            
            return { 
                ipv4, 
                ipv6, 
                org, 
                city, 
                region, 
                country, 
                loc 
            };
        }
        
        // 使用高德地图API获取详细地理位置信息
        async function getDetailedLocationInfo(loc) {
            const [latitude, longitude] = loc.split(',');
            const amapKey = 'bda831a9a224d37e982ff680fbbeeb43';
            
            let detailedInfo = {
                address: "未知地址",
                province: "未知省份",
                city: "未知城市",
                district: "未知区县",
                township: "未知乡镇",
                neighborhood: "未知小区",
                street: "未知街道",
                streetNumber: "未知门牌号",
                businessAreas: "未知商圈",
                formattedAddress: "未知格式化地址",
                pois: []
            };
            
            try {
                const response = await fetch(`https://restapi.amap.com/v3/geocode/regeo?output=json&location=${longitude},${latitude}&key=${amapKey}&radius=1000&extensions=all`);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.status === '1' && data.regeocode) {
                        const addressComponent = data.regeocode.addressComponent;
                        const pois = data.regeocode.pois || [];
                        
                        // 提取附近机构信息
                        const nearbyInstitutions = pois
                            .filter(poi => 
                                poi.type.includes('政府') || 
                                poi.type.includes('公安') || 
                                poi.type.includes('医院') || 
                                poi.type.includes('学校') || 
                                poi.type.includes('消防') || 
                                poi.type.includes('教育')
                            )
                            .map(poi => poi.name)
                            .slice(0, 3); // 只取前3个
                        
                        detailedInfo = {
                            address: data.regeocode.formatted_address || "未知地址",
                            province: addressComponent.province || "未知省份",
                            city: addressComponent.city || "未知城市",
                            district: addressComponent.district || "未知区县",
                            township: addressComponent.township || "未知乡镇",
                            neighborhood: addressComponent.neighborhood && addressComponent.neighborhood.name ? addressComponent.neighborhood.name : "未知小区",
                            street: addressComponent.streetNumber && addressComponent.streetNumber.street ? addressComponent.streetNumber.street : "未知街道",
                            streetNumber: addressComponent.streetNumber && addressComponent.streetNumber.number ? addressComponent.streetNumber.number : "未知门牌号",
                            businessAreas: addressComponent.businessAreas && addressComponent.businessAreas.length > 0 ? 
                                addressComponent.businessAreas.map(area => area.name).join(',') : "未知商圈",
                            formattedAddress: data.regeocode.formatted_address || "未知格式化地址",
                            pois: nearbyInstitutions
                        };
                    }
                }
            } catch (error) {
                console.log("获取高德地图信息失败:", error);
            }
            
            return detailedInfo;
        }
        
        // 生成设备唯一标识
        function getDeviceId() {
            let deviceId = localStorage.getItem('deviceId');
            if (!deviceId) {
                deviceId = 'dev_' + Math.random().toString(36).substr(2, 9) + '_' + new Date().getTime();
                localStorage.setItem('deviceId', deviceId);
            }
            return deviceId;
        }
        
        // 更新统计信息
        function updateStats() {
            const records = JSON.parse(localStorage.getItem('accessRecords') || '[]');
            const uniqueDevices = new Set(records.map(record => record.deviceId));
            
            document.getElementById('total-visits').textContent = records.length;
            document.getElementById('unique-devices').textContent = uniqueDevices.size;
        }
        
        // 显示访问记录
        function displayAccessRecords() {
            const records = JSON.parse(localStorage.getItem('accessRecords') || '[]');
            const tbody = document.getElementById('access-records');
            const showIPv4 = document.getElementById('ipv4-toggle').classList.contains('active');
            
            tbody.innerHTML = '';
            
            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">暂无访问记录</td></tr>';
                return;
            }
            
            records.forEach(record => {
                const tr = document.createElement('tr');
                
                // 确定要显示的IP
                const displayIP = showIPv4 ? record.ipv4 : record.ipv6;
                const ipType = showIPv4 ? 
                    (displayIP.includes('.') ? 'IPv4' : '未知') : 
                    (displayIP.includes(':') ? 'IPv6' : '未知');
                
                // 网络类型标签
                const networkLabel = record.networkLabel !== '未知' ? 
                    `<span class="network-type-badge ${record.networkBadgeClass}">${record.networkLabel}</span>` : '';
                
                // 设备机型标签
                const deviceModelLabel = record.deviceModel !== '未知设备' ? 
                    `<span class="device-model-badge">${record.deviceModel}</span>` : '';
                
                // 位置信息 - 创建工具提示显示详细信息
                const locationTooltip = `
                    <div class="tooltip">
                        ${record.city}${record.district !== '未知区县' ? `-${record.district}` : ''}
                        <span class="tooltiptext">
                            <strong>详细位置信息:</strong><br>
                            经纬度: ${record.loc}<br>
                            地址: ${record.formattedAddress}<br>
                            省份: ${record.province}<br>
                            城市: ${record.city}<br>
                            区县: ${record.district}<br>
                            乡镇: ${record.township}<br>
                            小区: ${record.neighborhood}<br>
                            街道: ${record.street} ${record.streetNumber}<br>
                            运营商: ${record.org}<br>
                            附近机构: ${record.pois.length > 0 ? record.pois.join(', ') : '无'}
                        </span>
                    </div>
                `;
                
                tr.innerHTML = `
                    <td>${record.time}</td>
                    <td>${record.device} ${deviceModelLabel} <span class="device-id-badge">${record.deviceId.substring(0, 8)}</span></td>
                    <td>${record.browser}</td>
                    <td>${record.os}</td>
                    <td class="ip-column">${displayIP} ${ipType !== '未知' ? `<span class="ip-type-badge">${ipType}</span>` : ''} ${networkLabel}</td>
                    <td class="location-column">${locationTooltip}</td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // IP版本切换
        document.getElementById('ipv4-toggle').addEventListener('click', function() {
            this.classList.add('active');
            document.getElementById('ipv6-toggle').classList.remove('active');
            displayAccessRecords();
        });
        
        document.getElementById('ipv6-toggle').addEventListener('click', function() {
            this.classList.add('active');
            document.getElementById('ipv4-toggle').classList.remove('active');
            displayAccessRecords();
        });
        
        // 清除记录
        document.getElementById('clear-records').addEventListener('click', function() {
            if (confirm('确定要清除所有访问记录吗？')) {
                localStorage.removeItem('accessRecords');
                displayAccessRecords();
                updateStats();
            }
        });
        
        // 检测开发者工具
        function checkDevTools() {
            const widthThreshold = window.outerWidth - window.innerWidth > 100;
            const heightThreshold = window.outerHeight - window.innerHeight > 100;
            
            if (widthThreshold || heightThreshold) {
                document.getElementById('devtools-warning').style.display = 'block';
                // 尝试禁用右键菜单
                document.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    return false;
                });
                
                // 尝试禁用键盘快捷键
                document.addEventListener('keydown', function(e) {
                    // 禁用F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
                    if (
                        e.key === 'F12' ||
                        (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                        (e.ctrlKey && e.shiftKey && e.key === 'J') ||
                        (e.ctrlKey && e.key === 'U')
                    ) {
                        e.preventDefault();
                        return false;
                    }
                });
            } else {
                document.getElementById('devtools-warning').style.display = 'none';
            }
        }
        
        // 检测是否为PC端访问
        function checkIfPC() {
            if (getDeviceType() === "桌面设备") {
                document.getElementById('pc-redirect-notice').style.display = 'flex';
                setTimeout(() => {
                    window.location.href = 'https://dongshengamestudio.github.io/error30081690014443201/';
                }, 2000);
                return true;
            }
            return false;
        }
        
        // 保存访问记录到localStorage
        async function saveAccessRecord() {
            // 检查是否为PC端，如果是则不记录
            if (getDeviceType() === "桌面设备") {
                document.getElementById('loading-overlay').style.display = 'none';
                clearInterval(countdownInterval);
                return;
            }
            
            try {
                const ipData = await getIPAddress();
                const now = new Date();
                const accessTime = now.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                // 获取网络类型信息
                const networkInfo = getNetworkType();
                
                // 获取设备机型
                const deviceModel = getDeviceModel();
                
                // 获取详细位置信息
                const detailedLocation = await getDetailedLocationInfo(ipData.loc);
                
                const record = {
                    time: accessTime,
                    device: getDeviceType(),
                    browser: getBrowserInfo(),
                    os: getOSInfo(),
                    ipv4: ipData.ipv4,
                    ipv6: ipData.ipv6,
                    org: ipData.org,
                    city: ipData.city,
                    region: ipData.region,
                    country: ipData.country,
                    loc: ipData.loc,
                    networkType: networkInfo.type,
                    networkLabel: networkInfo.label,
                    networkBadgeClass: networkInfo.badgeClass,
                    deviceModel: deviceModel,
                    deviceId: getDeviceId(),
                    // 高德地图返回的详细信息
                    province: detailedLocation.province,
                    district: detailedLocation.district,
                    township: detailedLocation.township,
                    neighborhood: detailedLocation.neighborhood,
                    street: detailedLocation.street,
                    streetNumber: detailedLocation.streetNumber,
                    businessAreas: detailedLocation.businessAreas,
                    formattedAddress: detailedLocation.formattedAddress,
                    pois: detailedLocation.pois
                };
                
                // 从localStorage获取现有记录
                let records = JSON.parse(localStorage.getItem('accessRecords') || '[]');
                
                // 添加新记录
                records.unshift(record);
                
                // 只保留最近50条记录
                if (records.length > 50) {
                    records = records.slice(0, 50);
                }
                
                // 保存回localStorage
                localStorage.setItem('accessRecords', JSON.stringify(records));
                
                // 更新显示
                displayAccessRecords();
                updateStats();
                
            } catch (error) {
                console.error("保存访问记录失败:", error);
            } finally 
        }
        
            }, 1000);
        }
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始检测
            if (checkIfPC()) {
                document.getElementById('loading-overlay').style.display = 'none';
                return; // 如果是PC端，不执行后续代码
            }
            
            checkDevTools();
            
            // 先显示现有记录
            displayAccessRecords();
            updateStats();
            
            // 启动16秒倒计时
            startCountdown();
            
            // 然后保存新访问记录
            saveAccessRecord();
            
            // 每0.5秒检测一次开发者工具
            setInterval(checkDevTools, 500);
            
            // 每秒检测一次是否为PC端访问
            setInterval(checkIfPC, 1000);
        });
    </script>
</body>
</html>